<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Telos â€” Goal Tree</title>
  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#60a5fa">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Telos">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('/sw.js')
        .catch(e => console.warn('SW reg failed:', e)));
    }
  </script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    :root {
      --bg-primary: #0f0f1a;
      --bg-secondary: #161625;
      --bg-glass: rgba(16, 16, 30, 0.88);
      --text-primary: #f0f0f5;
      --text-secondary: #a0a0b8;
      --border-subtle: rgba(255, 255, 255, 0.08);
      --border-hover: rgba(255, 255, 255, 0.18);
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.4);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.5);
      --shadow-lg: 0 8px 32px rgba(0,0,0,0.6);
      --radius-sm: 8px;
      --radius-md: 12px;
      --status-done: #999999;
      --status-progress: #4A90D9;
      --status-open: #f5f5f5;
      --status-blocked: #E05C5C;
      --status-refused: #9ca3af;
      --status-shelved: #cccccc;
      --status-rejected: #777777;
      --status-question: #F5C842;
      --transition-fast: 180ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-smooth: 350ms cubic-bezier(0.4, 0, 0.2, 1);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(160deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, #0d1b2a 100%);
      color: var(--text-primary);
      overflow: hidden;
      touch-action: pan-x pan-y;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #header {
      background: var(--bg-glass);
      backdrop-filter: blur(20px) saturate(1.5);
      -webkit-backdrop-filter: blur(20px) saturate(1.5);
      padding: 10px 16px;
      border-bottom: 1px solid var(--border-subtle);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      z-index: 200;
      height: 44px;
    }

    h1 {
      font-size: 15px;
      font-weight: 600;
      letter-spacing: -0.01em;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    h1 span { font-size: 16px; }

    #controls {
      display: flex;
      gap: 6px;
      overflow-x: auto;
      overflow-y: hidden;
      -webkit-overflow-scrolling: touch;
      max-width: 100%;
      flex-shrink: 1;
    }
    #controls::-webkit-scrollbar {
      height: 3px;
    }
    #controls::-webkit-scrollbar-track {
      background: transparent;
    }
    #controls::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.2);
      border-radius: 2px;
    }

    button {
      background: rgba(255, 255, 255, 0.06);
      color: var(--text-secondary);
      border: 1px solid var(--border-subtle);
      padding: 5px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 500;
      letter-spacing: 0.02em;
      transition: all var(--transition-fast);
      white-space: nowrap;
      user-select: none;
      -webkit-user-select: none;
    }
    button:hover {
      background: rgba(255, 255, 255, 0.12);
      color: var(--text-primary);
      border-color: var(--border-hover);
    }
    button:active { transform: scale(0.96); }
    button:focus-visible {
      outline: 2px solid var(--status-progress);
      outline-offset: 2px;
    }

    /* â”€â”€ SVG container â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #container {
      width: 100vw;
      height: calc(100vh - 44px);
      position: relative;
    }

    #container svg { display: block; }

    /* â”€â”€ Nodes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .node { cursor: pointer; }
    .node circle {
      stroke-width: 2px;
      transition: all var(--transition-smooth);
    }
    .node:hover circle,
    .node:focus circle {
      filter: brightness(1.25) drop-shadow(0 0 10px currentColor);
      stroke-width: 2.5px;
    }
    .node:focus { outline: none; }
    .node:focus circle {
      stroke: #fff;
      stroke-width: 3px;
      filter: brightness(1.3) drop-shadow(0 0 12px currentColor);
    }

    .node text {
      font-family: inherit;
      font-weight: 500;
      fill: var(--text-primary);
      text-anchor: middle;
      pointer-events: none;
      dominant-baseline: auto;
      transition: opacity var(--transition-fast);
    }

    /* â”€â”€ Expand/collapse indicator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .node .indicator {
      fill: rgba(255,255,255,0.5);
      font-size: 9px;
      font-weight: 700;
      pointer-events: none;
      dominant-baseline: central;
      text-anchor: middle;
    }

    /* â”€â”€ Links â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .link {
      fill: none;
      stroke: rgba(255, 255, 255, 0.1);
      stroke-width: 1.5px;
    }

    /* â”€â”€ Status colors â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .status-done circle          { fill: var(--status-done);     stroke: rgba(153,153,153,0.4); }
    .status-in_progress circle   { fill: var(--status-progress); stroke: rgba(74,144,217,0.4); }
    .status-open circle          { fill: var(--status-open);     stroke: rgba(200,200,200,0.5); }
    .status-blocked circle       { fill: var(--status-blocked);  stroke: rgba(224,92,92,0.4); }
    .status-out_of_budget circle { fill: var(--status-blocked);  stroke: rgba(224,92,92,0.4); }
    .status-refused circle       { fill: var(--status-refused);  stroke: rgba(156,163,175,0.4); }
    .status-shelved circle       { fill: var(--status-shelved);  stroke: rgba(204,204,204,0.4); opacity: 0.6; }
    .status-rejected circle      { fill: var(--status-rejected); stroke: rgba(119,119,119,0.4); }
    .status-in_question circle   { fill: var(--status-question); stroke: rgba(245,200,66,0.4); }

    /* â”€â”€ Tooltip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #tooltip {
      position: absolute;
      background: var(--bg-glass);
      backdrop-filter: blur(24px) saturate(1.8);
      -webkit-backdrop-filter: blur(24px) saturate(1.8);
      color: var(--text-primary);
      padding: 12px 14px;
      border-radius: var(--radius-md);
      pointer-events: none;
      font-size: 11px;
      line-height: 1.55;
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--border-subtle);
      max-width: 260px;
      z-index: 1000;
      opacity: 0;
      transform: translateY(4px);
      transition: opacity var(--transition-fast), transform var(--transition-fast);
    }
    #tooltip.visible {
      opacity: 1;
      transform: translateY(0);
    }
    #tooltip .title {
      font-weight: 600;
      font-size: 12px;
      margin-bottom: 6px;
      padding-bottom: 5px;
      border-bottom: 1px solid var(--border-subtle);
    }
    #tooltip .row {
      display: flex;
      justify-content: space-between;
      margin: 2px 0;
      gap: 12px;
    }
    #tooltip .label { color: var(--text-secondary); font-size: 10px; }
    #tooltip .value { color: var(--text-primary); font-weight: 500; font-size: 10px; }

    /* â”€â”€ Legend â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #legend {
      position: fixed;
      bottom: 12px;
      left: 12px;
      background: var(--bg-glass);
      backdrop-filter: blur(20px) saturate(1.5);
      -webkit-backdrop-filter: blur(20px) saturate(1.5);
      border-radius: var(--radius-sm);
      font-size: 10px;
      z-index: 100;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-md);
      transition: all var(--transition-smooth);
      overflow: hidden;
      max-height: 60vh;
      overflow-y: auto;
    }

    #legend .legend-inner {
      padding: 10px 12px;
    }

    #legend .legend-title {
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text-primary);
      font-size: 11px;
      letter-spacing: 0.02em;
    }
    #legend .legend-item {
      display: flex;
      align-items: center;
      margin: 4px 0;
    }
    #legend .legend-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 7px;
      flex-shrink: 0;
      box-shadow: 0 0 4px rgba(0,0,0,0.3);
    }
    #legend .legend-label {
      color: var(--text-secondary);
    }

    /* Legend toggle button (visible < 400px) */
    #legend-toggle {
      display: none;
      width: 36px;
      height: 36px;
      border-radius: var(--radius-sm);
      background: var(--bg-glass);
      backdrop-filter: blur(20px) saturate(1.5);
      -webkit-backdrop-filter: blur(20px) saturate(1.5);
      border: 1px solid var(--border-subtle);
      color: var(--text-secondary);
      font-size: 16px;
      cursor: pointer;
      position: absolute;
      bottom: 12px;
      left: 12px;
      z-index: 101;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
      box-shadow: var(--shadow-sm);
      padding: 0;
    }
    #legend-toggle:hover {
      background: rgba(255,255,255,0.12);
      color: var(--text-primary);
    }
    #legend-toggle:focus-visible {
      outline: 2px solid var(--status-progress);
      outline-offset: 2px;
    }

    /* â”€â”€ Error state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #error {
      padding: 32px;
      text-align: center;
      color: var(--status-blocked);
      font-size: 14px;
    }

    /* â”€â”€ Tab bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #tab-bar {
      display: flex;
      gap: 4px;
    }
    .tab-btn {
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border-subtle);
      color: var(--text-secondary);
      padding: 4px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 11px;
      font-weight: 500;
      transition: all var(--transition-fast);
    }
    .tab-btn.active {
      background: rgba(96,165,250,0.2);
      border-color: rgba(96,165,250,0.4);
      color: #60a5fa;
    }

    /* â”€â”€ Done filter control â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #done-filter-wrap {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 11px;
      color: var(--text-secondary);
    }
    #done-filter-wrap label {
      white-space: nowrap;
      font-size: 10px;
      color: var(--text-secondary);
      user-select: none;
      -webkit-user-select: none;
    }
    #done-filter {
      background: rgba(255,255,255,0.06);
      color: var(--text-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      font-size: 11px;
      font-family: inherit;
      padding: 4px 6px;
      cursor: pointer;
      transition: all var(--transition-fast);
      color-scheme: dark;
    }
    #done-filter:hover {
      background: rgba(255,255,255,0.1);
      color: var(--text-primary);
      border-color: var(--border-hover);
    }
    #done-filter:focus {
      outline: 2px solid var(--status-progress);
      outline-offset: 2px;
    }

    /* â”€â”€ Detail Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #detail-panel {
      position: fixed;
      top: 0;
      right: -420px;
      width: 400px;
      height: 100%;
      background: var(--bg-glass);
      backdrop-filter: blur(32px) saturate(1.8);
      -webkit-backdrop-filter: blur(32px) saturate(1.8);
      border-left: 1px solid var(--border-subtle);
      box-shadow: -8px 0 32px rgba(0,0,0,0.4);
      z-index: 900;
      overflow-y: auto;
      transition: right 0.28s cubic-bezier(0.4,0,0.2,1);
      padding: 0;
    }
    #detail-panel.open { right: 0; }
    #detail-panel-header {
      position: sticky;
      top: 0;
      background: rgba(15,20,30,0.9);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      padding: 16px 20px 12px;
      border-bottom: 1px solid var(--border-subtle);
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }
    #detail-panel-title {
      flex: 1;
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1.4;
    }
    #detail-panel-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 18px;
      cursor: pointer;
      padding: 0 4px;
      line-height: 1;
      flex-shrink: 0;
    }
    #detail-panel-close:hover { color: var(--text-primary); }
    #detail-panel-body { padding: 16px 20px 32px; }
    .dp-section {
      margin-bottom: 18px;
    }
    .dp-section-title {
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }
    .dp-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      padding: 4px 0;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      font-size: 11px;
    }
    .dp-row:last-child { border-bottom: none; }
    .dp-label { color: var(--text-secondary); }
    .dp-value { color: var(--text-primary); font-weight: 500; text-align: right; max-width: 60%; }
    .dp-description-box {
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-sm);
      padding: 10px 12px;
      font-size: 11px;
      line-height: 1.7;
      color: var(--text-primary);
    }
    .dp-desc-collapsed .dp-desc-full { display: none; }
    .dp-desc-collapsed .dp-desc-preview { display: block; }
    .dp-desc-expanded .dp-desc-preview { display: none; }
    .dp-desc-expanded .dp-desc-full { display: block; }
    .dp-desc-toggle {
      background: none;
      border: none;
      color: var(--text-accent, #60a5fa);
      font-size: 10px;
      cursor: pointer;
      padding: 4px 0 0;
      display: block;
    }
    .dp-progress-bar-bg {
      height: 6px;
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
      overflow: hidden;
      margin-top: 4px;
    }
    .dp-progress-bar-fill {
      height: 100%;
      background: #4ade80;
      border-radius: 3px;
      transition: width 0.4s ease;
    }
    .dp-note {
      font-size: 10px;
      color: var(--text-secondary);
      padding: 4px 0;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      line-height: 1.5;
    }
    .dp-note:last-child { border-bottom: none; }
    .dp-note-ts { color: rgba(255,255,255,0.3); font-size: 9px; }
    .dp-note-pct { color: #4ade80; font-size: 9px; }
    .dp-badge {
      display: inline-block;
      padding: 2px 7px;
      border-radius: 10px;
      font-size: 10px;
      font-weight: 600;
    }
    .badge-done        { background: rgba(52,211,153,0.18);  color: #34d399; }
    .badge-in_progress { background: rgba(96,165,250,0.18);  color: #60a5fa; }
    .badge-open        { background: rgba(251,191,36,0.18);  color: #fbbf24; }
    .badge-blocked     { background: rgba(248,113,113,0.18); color: #f87171; }
    .badge-refused     { background: rgba(156,163,175,0.18); color: #9ca3af; }
    .badge-shelved     { background: rgba(107,114,128,0.18); color: #9ca3af; opacity: 0.7; }
    .badge-rejected    { background: rgba(153,27,27,0.25);   color: #fca5a5; text-decoration: line-through; }
    .badge-in_question { background: rgba(245,158,11,0.18);  color: #fbbf24; }

    /* â”€â”€ Ideas panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #ideas-panel {
      display: none;
      width: 100vw;
      height: calc(100vh - 44px);
      overflow-y: auto;
      padding: 20px;
    }
    #ideas-panel.visible { display: block; }

    .ideas-section { margin-bottom: 28px; }
    .ideas-section h2 {
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--text-secondary);
      margin-bottom: 10px;
      padding-bottom: 6px;
      border-bottom: 1px solid var(--border-subtle);
    }
    .ideas-section h2 .badge {
      display: inline-block;
      background: rgba(255,255,255,0.08);
      border-radius: 10px;
      padding: 1px 7px;
      font-size: 10px;
      margin-left: 6px;
      vertical-align: middle;
    }

    .idea-card {
      background: var(--bg-glass);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      padding: 12px 14px;
      margin-bottom: 10px;
      backdrop-filter: blur(10px);
      transition: border-color var(--transition-fast);
    }
    .idea-card:hover { border-color: var(--border-hover); }

    .idea-header {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 6px;
    }
    .idea-status-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
      margin-top: 4px;
    }
    .idea-status-active   { background: var(--status-done); }
    .idea-status-parked   { background: var(--status-open); }
    .idea-status-rejected { background: var(--status-refused); }

    .idea-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      flex: 1;
    }
    .idea-id {
      font-size: 10px;
      color: var(--text-secondary);
      flex-shrink: 0;
    }

    .idea-body {
      font-size: 11px;
      color: var(--text-secondary);
      line-height: 1.55;
      margin-left: 18px;
    }
    .idea-body p { margin: 4px 0; }
    .idea-body strong { color: var(--text-primary); }

    .idea-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-left: 18px;
      margin-top: 6px;
    }
    .idea-tag {
      background: rgba(255,255,255,0.07);
      border: 1px solid var(--border-subtle);
      border-radius: 4px;
      padding: 1px 7px;
      font-size: 10px;
      color: var(--text-secondary);
    }

    .ideas-empty {
      color: var(--text-secondary);
      font-size: 12px;
      font-style: italic;
      padding: 8px 0;
    }

    /* â”€â”€ Responsive: narrow viewports â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 400px) {
      #legend { display: none; }
      #legend.legend-expanded { display: block; }
      #legend-toggle { display: flex; }
    }

    @media (max-width: 640px) {
      #detail-panel { width: 100%; right: -100%; }
      #detail-panel.open { right: 0; }
    }

    /* â”€â”€ Mobile: Bottom Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #bottom-nav {
      display: none;
      position: fixed;
      bottom: 0; left: 0; right: 0;
      height: auto;
      min-height: 60px;
      background: rgba(15, 15, 26, 0.96);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-top: 1px solid var(--border-subtle);
      z-index: 800;
      display: flex;
      align-items: center;
      justify-content: space-around;
      padding: 8px 0;
      padding-bottom: max(8px, env(safe-area-inset-bottom, 0px));
    }
    .bnav-btn {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 3px;
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 10px;
      cursor: pointer;
      padding: 8px;
      transition: color var(--transition-fast);
      -webkit-tap-highlight-color: transparent;
      min-height: 44px;
      min-width: 44px;
    }
    .bnav-btn .bnav-icon { font-size: 22px; line-height: 1; display: flex; align-items: center; }
    .bnav-btn.active { color: var(--text-accent, #60a5fa); }
    .bnav-btn.active .bnav-icon { filter: drop-shadow(0 0 6px #60a5fa88); }

    /* â”€â”€ Card List View â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #list-view {
      display: none;
      overflow-y: auto;
      padding: 12px 12px 80px;
      height: 100%;
    }
    #list-view.active { display: block; }
    .lv-group { margin-bottom: 20px; }
    .lv-group-title {
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text-secondary);
      padding: 0 4px 8px;
    }
    .lv-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      padding: 12px 14px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: border-color var(--transition-fast), background var(--transition-fast);
      -webkit-tap-highlight-color: transparent;
    }
    .lv-card:active { background: rgba(255,255,255,0.06); }
    .lv-card-top {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }
    .lv-card-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      line-height: 1.35;
      flex: 1;
    }
    .lv-card-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 10px;
      color: var(--text-secondary);
      flex-wrap: wrap;
    }
    .lv-card-roi { font-weight: 700; color: var(--text-accent, #60a5fa); }
    .lv-card-progress {
      height: 3px;
      background: rgba(255,255,255,0.1);
      border-radius: 2px;
      overflow: hidden;
      margin-top: 8px;
    }
    .lv-card-progress-fill {
      height: 100%;
      background: #4ade80;
      border-radius: 2px;
    }

    /* â”€â”€ Mobile overrides â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 768px) {
      /* Show bottom nav, hide top tabs */
      #bottom-nav { display: flex; }
      .tab-bar { display: none !important; }
      /* Push content above bottom nav with safe area */
      #container, #list-view, #ideas-panel { 
        padding-bottom: max(76px, calc(68px + env(safe-area-inset-bottom, 0px))); 
      }
      /* Slightly bigger tree circles for fat fingers */
      .node circle { stroke-width: 2px; }
      /* Make header controls wrap/scroll better */
      #topbar { flex-wrap: wrap; gap: 6px; }
      #controls { max-width: 100%; }
      #controls button { min-height: 36px; padding: 6px 10px; font-size: 11px; }
      #done-filter { min-height: 36px; }
      /* Tooltip: position at bottom on mobile */
      #tooltip { max-width: calc(100vw - 24px); left: 12px !important; right: 12px !important; }
      /* Legend improvements for mobile */
      #legend { max-width: 85vw; right: auto; }
      #legend-toggle { display: flex; }
    }

    @media (max-width: 600px) {
      /* Smaller screens: make legend even smaller */
      #legend .legend-inner { padding: 8px 10px; }
      #legend .legend-item { margin: 3px 0; }
      #legend .legend-dot { width: 7px; height: 7px; }
      #legend .legend-label { font-size: 9px; }
      /* Reduce header padding on very small screens */
      #header { padding: 8px 12px; height: 40px; }
      h1 { font-size: 14px; }
      h1 span { font-size: 14px; }
    }

    @media (max-width: 400px) {
      #legend { display: none; }
      #legend.legend-expanded { display: block; max-width: 90vw; }
      #legend-toggle { display: flex; }
      /* Increase bottom nav on small screens for better usability */
      .bnav-btn { min-height: 48px; min-width: 48px; }
      .bnav-btn .bnav-icon { font-size: 24px; }
    }

    /* â”€â”€ Skip-to-content for accessibility â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0,0,0,0);
      white-space: nowrap;
      border: 0;
    }
  </style>
</head>
<body>
  <a class="sr-only" href="#container">Skip to goal tree</a>

  <div id="header" role="banner">
    <h1><span>ğŸŒ</span> Telos</h1>
    <div style="display:flex;align-items:center;gap:12px;">
      <div id="tab-bar" role="tablist" aria-label="View tabs">
        <button class="tab-btn active" id="tab-tree"  onclick="switchTab('tree')"  role="tab" aria-selected="true">ğŸŒ³ Tree</button>
        <button class="tab-btn"        id="tab-ideas" onclick="switchTab('ideas')" role="tab" aria-selected="false">ğŸ’¡ Ideas</button>
      </div>
      <div id="done-filter-wrap" aria-label="Done task filter">
        <label for="done-filter">Hide done&nbsp;&gt;</label>
        <select id="done-filter" onchange="setDoneFilter(parseInt(this.value))" aria-label="Hide done tasks older than N days">
          <option value="0">off</option>
          <option value="1">1 day</option>
          <option value="3">3 days</option>
          <option value="7">7 days</option>
          <option value="30">30 days</option>
          <option value="90">90 days</option>
        </select>
      </div>
      <div id="controls" role="toolbar" aria-label="Tree controls">
        <button onclick="resetView()" aria-label="Reset view to fit all nodes">Reset</button>
        <button onclick="expandAll()" aria-label="Expand all nodes">Expand</button>
        <button onclick="collapseAll()" aria-label="Collapse all nodes">Collapse</button>
        <button id="refresh-data-btn" onclick="refreshData()" aria-label="Reload goal tree data">â†»</button>
        <span id="last-updated" style="font-size:10px;color:var(--text-secondary);white-space:nowrap;padding:0 2px;"></span>
      </div>
    </div>
  </div>

  <div id="container" role="tree" aria-label="Telos goal tree visualization"></div>
  <div id="list-view" role="list" aria-label="Node list view"></div>

  <!-- Mobile bottom navigation -->
  <nav id="bottom-nav" aria-label="Main navigation">
    <button class="bnav-btn active" id="bnav-tree" onclick="switchTab('tree')" aria-label="Tree view">
      <span class="bnav-icon">ğŸŒ³</span>
      <span>Tree</span>
    </button>
    <button class="bnav-btn" id="bnav-list" onclick="switchTab('list')" aria-label="List view">
      <span class="bnav-icon">ğŸ“‹</span>
      <span>List</span>
    </button>
    <button class="bnav-btn" id="bnav-ideas" onclick="switchTab('ideas')" aria-label="Ideas">
      <span class="bnav-icon">ğŸ’¡</span>
      <span>Ideas</span>
    </button>
    <button class="bnav-btn" id="bnav-refresh" onclick="refreshData()" aria-label="Refresh data">
      <span class="bnav-icon">â†»</span>
      <span>Sync</span>
    </button>
  </nav>
  <div id="detail-panel" role="complementary" aria-label="Node detail">
    <div id="detail-panel-header">
      <div id="detail-panel-title">â€”</div>
      <button id="detail-panel-close" onclick="closeDetailPanel()" aria-label="Close detail panel">âœ•</button>
    </div>
    <div id="detail-panel-body"></div>
  </div>
  <div id="ideas-panel" role="tabpanel" aria-label="Ideas backlog"></div>
  <div id="tooltip" role="tooltip" aria-live="polite"></div>

  <button id="legend-toggle" aria-label="Toggle legend" onclick="toggleLegend()">â—‘</button>
  <div id="legend" role="complementary" aria-label="Status legend">
    <div class="legend-inner">
      <div class="legend-title">Status</div>
      <div class="legend-item">
        <div class="legend-dot" style="background: var(--status-done);"></div>
        <span class="legend-label">Done</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: var(--status-progress);"></div>
        <span class="legend-label">In Progress</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: var(--status-open);"></div>
        <span class="legend-label">Open</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: var(--status-blocked);"></div>
        <span class="legend-label">Blocked</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: var(--status-question);"></div>
        <span class="legend-label">In Question</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: var(--status-shelved); opacity: 0.6;"></div>
        <span class="legend-label">Shelved</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: var(--status-rejected);"></div>
        <span class="legend-label">Rejected</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: var(--status-refused);"></div>
        <span class="legend-label">Refused</span>
      </div>
    </div>
  </div>

  <script src="viz.js"></script>
</body>
</html>
